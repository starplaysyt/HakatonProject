@model dynamic 
@using HakatonProject.Models.Repositories
@inject CurrentUserService CurrentUserService
@inject UserRepository UserRepository

@{
    ViewData["Title"] = "Home Page";

    string userName = CurrentUserService.GetCurrentUserName();

    var events = new[]
    {
        new { Name = "Культура", Start = "10:00", End = "12:00", Icon = "fa7-solid:museum" },
        new { Name = "Спорт", Start = "12:30", End = "14:00", Icon = "fa7-solid:basketball" },
        new { Name = "Музыка", Start = "15:00", End = "17:00", Icon = "fa7-solid:music" }
    };
}

@section Scripts
{
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Получаем данные с бэкенда через fetch
            fetch('/api/ChartData/owner-events')
                .then(response => response.json())
                .then(chartData => {
                    const ctx = document.getElementById('weekStatsChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: chartData,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false },
                                tooltip: { 
                                    enabled: true,
                                    callbacks: {
                                        // Заголовок тултипа (выводим info)
                                        title: function(context) {
                                            const raw = context[0].raw; // context — массив, берем первый элемент
                                            return raw.info || '';       // info из C#
                                        },
                                        // Основной текст тултипа (можно часы или пустой)
                                        label: function(context) {
                                            const raw = context.raw;
                                            if(raw && raw.y) {
                                                return `${raw.y[0]}:00 - ${raw.y[1]}:00`;
                                            }
                                            return '';
                                        }
                                    }
                                }
                            },
                            indexAxis: 'x',
                            scales: {
                                x: {
                                    position: 'top',
                                    grid: { display: false },
                                    border: { display: false },
                                    ticks: { color: '#E0E0E0' }
                                },
                                y: {
                                    type: 'linear',
                                    min: 10,
                                    max: 20,
                                    grid: { color: '#4A4C60', drawTicks: false },
                                    border: { display: false },
                                    ticks: {
                                        color: '#E0E0E0',
                                        stepSize: 2,
                                        callback: v => v + ':00',
                                        padding: 10
                                    }
                                }
                            }
                        }
                    });
                })
                .catch(error => console.error('Ошибка при загрузке данных для Chart.js:', error));
        });
                </script>
}

<div class="dashboard-container">
    <nav class="sidebar">
        <div class="sidebar-logo">
            <img alt="logo" src="assets/logo.png">
            Active Graph
        </div>
        <ul class="sidebar-nav">
                <li><a href="/" style="color: #fff;"><span class="iconify" data-icon="mynaui:home"></span></a></li>
                <li><a href="/Interest"><span class="iconify" data-icon="material-symbols:interests-rounded"></span></a></li>
                <li><a href="/EventsPage"><span class="iconify" data-icon="material-symbols:event-note-rounded"></span></a></li>
            </ul>
        <div class="sidebar-profile">
                <a href="/Analytics"><span class="iconify" data-icon="iconamoon:profile"></span></a>
        </div>
    </nav>

    <main class="main-content">

        <div class="widget welcome-card">
            <div class="welcome-header">
                <div class="user-icon"><span class="iconify" data-icon="iconamoon:profile"></span></div>
                <h2>Привет, @userName</h2>
            </div>
            <div class="sample-cards">
                <a href="/" style="text-decoration: none; color: inherit;">
                    <div class="sample-card">
                        <span class="iconify" data-icon="mynaui:home"></span>
                        <p>Главная</p>
                    </div>
                </a>
                <a href="/Interest" style="text-decoration: none; color: inherit;">
                    <div class="sample-card">
                        <span class="iconify" data-icon="material-symbols:interests-rounded"></span>
                        <p>Интересы</p>
                    </div>
                </a>
                <a href="/EventsPage" style="text-decoration: none; color: inherit;">
                    <div class="sample-card">
                        <span class="iconify" data-icon="material-symbols:event-note-rounded"></span>
                        <p>Мероприятия</p>
                    </div>
                </a>
            </div>
        </div>

        <div class="widget stats-card">
            <div class="stats-header">
                <h3>Статистика</h3>
                <div class="date-range">
                    <button id="btn-date"><span class="iconify" data-icon="mdi:navigate-before"></span></button>
                    10.02-17.02
                    <button id="btn-date"><span class="iconify" data-icon="mdi:navigate-next"></span></button>
                </div>
            </div>

            <div class="chart-wrapper">
                <canvas id="weekStatsChart"></canvas>

                
            </div>
        </div>

        <div class="widget events-card">
            <div class="header-ec"><h3><span class="iconify" data-icon="material-symbols:event-note-rounded"></span>
                    Мероприятия</h3></div>
            <ul class="event-list">
                @foreach (var e in events)
                {
                    <li>
                        <div class="event-icon"><span class="iconify" data-icon="@e.Icon"></span></div>
                        <div class="event-details">
                            <strong>@e.Name</strong>
                            <span>@e.Start - @e.End</span>
                        </div>
                    </li>
                }
                @* <li> *@
                @* <div class="event-icon"><span class="iconify" data-icon="fluent:sport-16-filled"></span></div> *@
                @* <div class="event-details"> *@
                @* <strong>Спорт</strong> *@
                @* <span>время начала-время конца</span> *@
                @* </div> *@
                @* </li> *@
                @* <li> *@
                @* <div class="event-icon"><span class="iconify" data-icon="mdi:volunteer"></span></div> *@
                @* <div class="event-details"> *@
                @* <strong>Волонтерство</strong> *@
                @* <span>время начала-время конца</span> *@
                @* </div> *@
                @* </li> *@
                @* <li> *@
                @* <div class="event-icon"><span class="iconify" data-icon="material-symbols:science"></span></div> *@
                @* <div class="event-details"> *@
                @* <strong>Наука</strong> *@
                @* <span>время начала-время конца</span> *@
                @* </div> *@
                @* </li> *@
                @* <li> *@
                @* <div class="event-icon"><span class="iconify" data-icon="mdi:court-hammer"></span></div> *@
                @* <div class="event-details"> *@
                @* <strong>Студ. самоуправ.</strong> *@
                @* <span>время начала-время конца</span> *@
                @* </div> *@
                @* </li> *@
            </ul>
        </div>

    </main>
</div>


